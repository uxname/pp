# cleaner Specification

## Purpose
TBD - created by archiving change add-comprehensive-comment-support. Update Purpose after archive.
## Requirements
### Requirement: Распознавание всех форм комментариев
Команда `clean` SHALL обнаруживать и удалять любую форму комментариев в файлах (`//`, `/* ... */`, HTML `<!-- ... -->` и т.п.), за исключением конструкций, подпадающих под `keepJSDoc` или пользовательскую/системную белую список. HTML `<!-- ... -->` следует удалять только в `.html`/`.htm` файлах, чтобы строки с похожими регулярными выражениями или литералами в TypeScript/JavaScript сохранялись нетронутыми. Удаление SHALL происходить без искажения окружающего кода и быть отражено в превьюхах `--dry-run`.

#### Scenario: Удаление многострочных блоков `/* ... */`
- **WHEN** `kodu clean` запускается на TS/JS файле, содержащем блок `/* ... */`, который не помечен как JSDoc или не входит в белый список
- **THEN** блок удаляется, окружающий код остаётся синтаксически корректным, и `--dry-run` показывает этот диапазон без применения изменений

#### Scenario: Удаление HTML-комментариев внутри шаблонов
- **WHEN** `kodu clean` запускается на файле шаблонов (`.html` или `.htm`) с комментариями вида `<!-- ... -->`
- **THEN** HTML-комментарии удаляются, структура шаблона сохраняется, и вывод/генерация не содержит лишних пробельных строк

#### Scenario: HTML-комментарий в TypeScript-литерале остаётся нетронутым
- **WHEN** `kodu clean` запускается на TS/JS файле, где внутри строки или регулярного выражения встречается шаблон `` `<!--[\s\S]*?-->` ``
- **THEN** текст остаётся неизменным, потому что HTML-разбор ограничивается только `.html`/`.htm` файлами

### Requirement: Очистка только изменённых файлов
Команда `clean` SHALL принимать флаг `--changed` (краткая форма `-c`), который переводит операцию в режим обработки только тех файлов, в которых Git зафиксировал изменения. При этом продолжают применяться правила расширения и теряется вывод, если под фильтр не попадает ни один файл. Переключение на `--dry-run` при этом остаётся возможным, оно только меняет сообщение без фактической записи.

#### Scenario: Очистка изменений в режиме `--changed`
- **WHEN** `kodu clean --changed` запускается в репозитории с изменёнными TypeScript/HTML файлами
- **THEN** команда удаляет комментарии только из изменённых файлов, остальные пропускаются, и подсчёт затронутых файлов/комментариев отражает только эту выборку

#### Scenario: Режим `--changed` без актуальных файлов
- **WHEN** `kodu clean --changed` запускается, но Git не выдаёт ни одного изменённого файла с подходящим расширением
- **THEN** команда ничего не меняет и выводит предупреждение `Нет изменённых файлов для очистки.`, а спиннер прекращает работу без выполнения `cleaner.cleanFiles`

